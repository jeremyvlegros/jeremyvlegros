{%- include ARRAY_EMPTY.liquid -%}

{%- assign array_tags = include.from_array_of_tags | uniq -%}

{%- comment -%} array_first_and_last_post_id {%- endcomment -%}

{% comment %}
@task : this is not how it should work > it should take only posts where all tags searched are present !
{% endcomment %}
{%- include as_array_the_first_and_last_post_id_from_array_of_tags.liquid from_array_of_tags=array_tags -%}
{%- assign array_first_and_last_post_id = return -%}
{%- assign return = null -%}
{%- comment -%} `Liquid` does not have functions {%- endcomment -%}

{%- assign first_post_id = array_first_and_last_post_id[0]-%}
{%- assign last_post_id  = array_first_and_last_post_id[1]-%}

{% comment %} main value {% endcomment %}
{%- assign array_html_posts= ARRAY_EMPTY -%}

{% comment %} for each tag {% endcomment %}
{%- for tag in array_tags -%}

    {% comment %}
    @task : this is not how it should work > it should take only posts where all tags searched are present !
    {% endcomment %}
    {%- comment -%} getting the posts for a tag {%- endcomment -%}
    {%- include as_posts_from_tag.liquid from_tag=tag -%}
    {%- assign posts = return -%}
    {%- assign return = null -%}
    {%- comment -%} `Liquid` does not have functions {%- endcomment -%}

    {%- comment -%} getting the posts as html {%- endcomment -%}
    {%- include as_string_the_html_content_for_the_posts_from_posts.liquid
            from_posts=posts
            with_first_post_id=first_post_id
            with_last_post_id=last_post_id
    -%}
    {%- assign html_posts = return -%}
    {%- assign return = null -%}
    {%- comment -%} `Liquid` does not have functions {%- endcomment -%}


    {% comment %} placing the posts in the array {% endcomment %}
    {%- assign array_html_posts = array_html_posts | push : html_posts -%}

{%- endfor -%}



{% comment %} removing duplicates{% endcomment %}
{%- assign array_html_posts = array_html_posts | uniq -%}

{% comment %}array without duplicates {{ array_html_posts | jsonify }}{% endcomment %}

{%- assign return = array_html_posts -%}


{%- assign array_html_posts = null -%}
